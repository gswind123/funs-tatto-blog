<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport"   content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/libs/swipe_style.css" />
    <link rel="stylesheet" href="assets/styles/page_style.css" />
</head>
<body style="overflow:hidden">
    <div id="pages_container" class="swipe-vertical">
        <div class="swipe-vertical-wrap" id="pages">
            <!-- add element pages here-->
        </div>
    </div>
</body>
<script src="assets/libs/swipe.js"></script>
<script src="assets/libs/jquery.min.js"></script>
<script type="text/javascript">
    var scale = 1 / window.devicePixelRatio;
    document.querySelector('meta[name="viewport"]').setAttribute('content','initial-scale=' + scale + ', maximum-scale=' + scale + ', minimum-scale=' + scale + ', user-scalable=no');
</script>
<script src="assets/views/index_page_item.js"></script>
<script>
    function injectData(serviceData) {
        var pages = document.querySelector("#pages");
        if(serviceData.result === 0) {
            var dataAry = serviceData.data;
            for(var i=0; i<dataAry.length; i++) {
                var dataItem = dataAry[i];
                var viewItem = new IndexPageItem();
                viewItem.setTitle(dataItem.title)
                        .setImgSrc(dataItem.imgSrc)
                        .setDesc(dataItem.desc)
                        .setImgFooter(dataItem.imgFooter);
                pages.appendChild(viewItem.getHTMLNode());
            }
        } else {
            pages.appendChild((new IndexPageItem()).setTitle("服务器错误\n页面加载失败").getHTMLNode());
        }
    }
    function initSwipe() {
        var page_container = document.querySelector("#pages_container");
        page_container.setAttribute("style",window.innerHeight+"px");

        var swipe = new Swipe(page_container,{
            startSlide: 0,
            speed: 400,
            autoStart:false,
            orientation:"vertical",
            auto: 0,
            draggable: true,
            continuous: false,
            disableScroll: true,
            stopPropagation: false,
            slideHeight : window.innerHeight
        });
    }
    //request service data
    (function($){
        $.ajax({
            url : '../index_data',
            type : 'POST',
            dataType : 'json',
            success : function(serviceData) {
                injectData(serviceData);
                initSwipe();
            },
            complete : function(xhr, err) {
                console.log(err);
            }
        });
    })(jQuery);

</script>
</html>

